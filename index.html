<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>åŸºå› çªå˜æ¨¡æ‹Ÿå™¨</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Bootstrap 5 CDN åšåŸºæœ¬æ’ç‰ˆ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body{background:#eef4fb}
        pre {font-family: "JetBrains Mono",Menlo,Consolas,monospace;}
        .base-A{color: #e44747;font-weight:600;} /* T ç”¨ç´«è‰²â€¦è‡ªå·±æ”¹ */
        .base-T{color: #9d2ad6;font-weight:600;}
        .base-G{color:#27ae60;font-weight:600;}
        .base-C{color: #28a5ff;font-weight:600;}
        #history {max-height:220px; overflow-y:auto}
    </style>
</head>
<body class="container py-4">

<h2 class="text-center mb-4 fw-bold">åŸºå› çªå˜æ¨¡æ‹Ÿå™¨ ğŸ§¬</h2>

<div class="row g-4">
    <!-- åŸå§‹åºåˆ— -->
    <div class="col-md-4">
        <div class="card shadow-sm">
            <div class="card-header bg-primary-subtle fw-bold">åŸå§‹åºåˆ—</div>
            <div class="card-body">
                <pre id="origin-template"></pre>
                <pre id="origin-coding"   class="mb-0"></pre>
                <pre id="origin-mrna"     class="mb-0"></pre>
                <div class="mt-2"><span class="fw-bold">æ°¨åŸºé…¸åºåˆ—ï¼š</span><span id="origin-aa"></span></div>
            </div>
        </div>
    </div>

    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="col-md-4">
        <div class="card shadow-sm">
            <div class="card-header bg-info-subtle fw-bold">æ§åˆ¶é¢æ¿</div>
            <div class="card-body">
                <div class="mb-2">é€‰æ‹©çªå˜ç±»å‹ï¼š</div>
                <div class="btn-group mb-3" role="group">
                    <input type="radio" class="btn-check" name="mutType" id="sub" value="sub" checked>
                    <label class="btn btn-outline-primary" for="sub">æ›¿æ¢</label>
                    <input type="radio" class="btn-check" name="mutType" id="ins" value="ins">
                    <label class="btn btn-outline-primary" for="ins">æ’å…¥</label>
                    <input type="radio" class="btn-check" name="mutType" id="del" value="del">
                    <label class="btn btn-outline-primary" for="del">ç¼ºå¤±</label>
                </div>

                <div class="mb-2">
                    <label class="form-label">ä½ç‚¹ (1-n æˆ–èŒƒå›´ 5-10)ï¼š</label>
                    <input id="pos" type="text" class="form-control" placeholder="å¦‚ 7 æˆ– 3-5">
                </div>

                <div id="base-wrapper" class="mb-3">
                    <label class="form-label">ç¢±åŸº (A/T/G/C)ï¼š</label>
                    <input id="base" type="text" maxlength="1" class="form-control" placeholder="ä»…æ›¿æ¢/æ’å…¥æ—¶å¡«å†™">
                </div>

                <button id="run" class="btn btn-success me-2">æ‰§è¡Œçªå˜</button>
                <button id="reset" class="btn btn-danger">é‡ç½®</button>

                <div id="tip" class="text-danger mt-3 small"></div>
            </div>
        </div>
    </div>

    <!-- çªå˜ååºåˆ— -->
    <div class="col-md-4">
        <div class="card shadow-sm">
            <div class="card-header bg-warning-subtle fw-bold">çªå˜ååºåˆ—</div>
            <div class="card-body">
                <pre id="mut-template"></pre>
                <pre id="mut-coding"   class="mb-0"></pre>
                <pre id="mut-mrna"     class="mb-0"></pre>
                <div class="mt-2"><span class="fw-bold">æ°¨åŸºé…¸åºåˆ—ï¼š</span><span id="mut-aa"></span></div>
            </div>
        </div>
    </div>
</div>

<!-- å†å²è®°å½• -->
<div class="card shadow-sm mt-4">
    <div class="card-header bg-secondary-subtle fw-bold">å†å²è®°å½•</div>
    <div class="card-body" id="history"></div>
</div>

<!-- === JavaScript é€»è¾‘ === -->
<script>
    /* ---------- DNA utils ---------- */
    const complementMap = {A:'T', T:'A', G:'C', C:'G'};
    const codonTable = {
        /* è‹¯ä¸™æ°¨é…¸ Phenylalanine */
        UUU: 'è‹¯ä¸™æ°¨é…¸', UUC: 'è‹¯ä¸™æ°¨é…¸',
        /* äº®æ°¨é…¸ Leucine */
        UUA: 'äº®æ°¨é…¸', UUG: 'äº®æ°¨é…¸', CUU: 'äº®æ°¨é…¸', CUC: 'äº®æ°¨é…¸', CUA: 'äº®æ°¨é…¸', CUG: 'äº®æ°¨é…¸',
        /* å¼‚äº®æ°¨é…¸ Isoleucine */
        AUU: 'å¼‚äº®æ°¨é…¸', AUC: 'å¼‚äº®æ°¨é…¸', AUA: 'å¼‚äº®æ°¨é…¸',
        /* ç”²ç¡«æ°¨é…¸ Methionine (èµ·å§‹) */
        AUG: 'ç”²ç¡«æ°¨é…¸',
        /* ç¼¬æ°¨é…¸ Valine */
        GUU: 'ç¼¬æ°¨é…¸', GUC: 'ç¼¬æ°¨é…¸', GUA: 'ç¼¬æ°¨é…¸', GUG: 'ç¼¬æ°¨é…¸',
        /* ä¸æ°¨é…¸ Serine */
        UCU: 'ä¸æ°¨é…¸', UCC: 'ä¸æ°¨é…¸', UCA: 'ä¸æ°¨é…¸', UCG: 'ä¸æ°¨é…¸', AGU: 'ä¸æ°¨é…¸', AGC: 'ä¸æ°¨é…¸',
        /* è„¯æ°¨é…¸ Proline */
        CCU: 'è„¯æ°¨é…¸', CCC: 'è„¯æ°¨é…¸', CCA: 'è„¯æ°¨é…¸', CCG: 'è„¯æ°¨é…¸',
        /* è‹æ°¨é…¸ Threonine */
        ACU: 'è‹æ°¨é…¸', ACC: 'è‹æ°¨é…¸', ACA: 'è‹æ°¨é…¸', ACG: 'è‹æ°¨é…¸',
        /* ä¸™æ°¨é…¸ Alanine */
        GCU: 'ä¸™æ°¨é…¸', GCC: 'ä¸™æ°¨é…¸', GCA: 'ä¸™æ°¨é…¸', GCG: 'ä¸™æ°¨é…¸',
        /* é…ªæ°¨é…¸ Tyrosine */
        UAU: 'é…ªæ°¨é…¸', UAC: 'é…ªæ°¨é…¸',
        /* ç»„æ°¨é…¸ Histidine */
        CAU: 'ç»„æ°¨é…¸', CAC: 'ç»„æ°¨é…¸',
        /* è°·æ°¨é…°èƒº Glutamine */
        CAA: 'è°·æ°¨é…°èƒº', CAG: 'è°·æ°¨é…°èƒº',
        /* å¤©å†¬é…°èƒº Asparagine */
        AAU: 'å¤©å†¬é…°èƒº', AAC: 'å¤©å†¬é…°èƒº',
        /* èµ–æ°¨é…¸ Lysine */
        AAA: 'èµ–æ°¨é…¸', AAG: 'èµ–æ°¨é…¸',
        /* å¤©å†¬æ°¨é…¸ Aspartic Acid */
        GAU: 'å¤©å†¬æ°¨é…¸', GAC: 'å¤©å†¬æ°¨é…¸',
        /* è°·æ°¨é…¸ Glutamic Acid */
        GAA: 'è°·æ°¨é…¸', GAG: 'è°·æ°¨é…¸',
        /* åŠèƒ±æ°¨é…¸ Cysteine */
        UGU: 'åŠèƒ±æ°¨é…¸', UGC: 'åŠèƒ±æ°¨é…¸',
        /* è‰²æ°¨é…¸ Tryptophan */
        UGG: 'è‰²æ°¨é…¸',
        /* ç²¾æ°¨é…¸ Arginine */
        CGU: 'ç²¾æ°¨é…¸', CGC: 'ç²¾æ°¨é…¸', CGA: 'ç²¾æ°¨é…¸', CGG: 'ç²¾æ°¨é…¸', AGA: 'ç²¾æ°¨é…¸', AGG: 'ç²¾æ°¨é…¸',
        /* ç”˜æ°¨é…¸ Glycine */
        GGU: 'ç”˜æ°¨é…¸', GGC: 'ç”˜æ°¨é…¸', GGA: 'ç”˜æ°¨é…¸', GGG: 'ç”˜æ°¨é…¸',
        /* ç»ˆæ­¢ Stop codons */
        UAA: 'ç»ˆæ­¢', UAG: 'ç»ˆæ­¢', UGA: 'ç»ˆæ­¢'
    };

    function complement(template){ // 3'->5' template to 5'->3' coding
        return template.split('').map(b=>complementMap[b]||b).reverse().join('');
    }
    function transcribe(coding){return coding.replace(/T/g,'U');}
    function translate(mrna){
        const aa = [];
        for (let i = 0; i + 2 < mrna.length; i += 3){
            const codon = mrna.substr(i,3);
            aa.push(codonTable[codon] || '???');
        }
        return aa;
    }
    function colour(seq, group=true){
        // â‘  é€å­—ç¬¦ä¸Šè‰²
        const colouredArr = seq.split('')
            .map(b => `<span class="base-${b}">${b}</span>`);

        // â‘¡ è‹¥ä¸éœ€è¦åˆ†ç»„ç›´æ¥è¿”å›
        if (!group) return colouredArr.join('');

        // â‘¢ æ¯ 3 ä¸ªä¸ºä¸€ç»„æ’å…¥ç©ºæ ¼
        const chunks = [];
        for (let i = 0; i < colouredArr.length; i += 3) {
            chunks.push(colouredArr.slice(i, i + 3).join(''));
        }
        return chunks.join(' ');
    }

    /* ---------- åˆå§‹æ•°æ® ---------- */
    let templateDNA = 'TAT TGA AAC TTG CGG TGC GAA'.replace(/\s+/g,'').toUpperCase();
    const originEls = {
        tpl: document.getElementById('origin-template'),
        cod: document.getElementById('origin-coding'),
        mrna: document.getElementById('origin-mrna'),
        aa:  document.getElementById('origin-aa'),
    };
    const mutEls = {
        tpl: document.getElementById('mut-template'),
        cod: document.getElementById('mut-coding'),
        mrna: document.getElementById('mut-mrna'),
        aa:  document.getElementById('mut-aa'),
    };
    const historyBox = document.getElementById('history');
    function renderAll(tplStr, target){
        const coding = complement(tplStr);
        const mrna   = transcribe(coding);
        const aaArr  = translate(mrna);
        target.tpl.innerHTML  = 'DNA æ¨¡æ¿é“¾ (3\'â†’5\'):\n'+colour(tplStr);
        target.cod.innerHTML  = 'DNA ç¼–ç é“¾ (5\'â†’3\'):\n'+colour(coding);
        target.mrna.innerHTML = 'mRNA  (5\'â†’3\'):\n'+colour(mrna);
        target.aa.innerHTML   = aaArr.join(' ');
    }
    // init
    renderAll(templateDNA, originEls);
    renderAll(templateDNA, mutEls);

    /* ---------- æ§ä»¶é€»è¾‘ ---------- */
    const posInput = document.getElementById('pos');
    const baseInput= document.getElementById('base');
    const runBtn    = document.getElementById('run');
    const resetBtn  = document.getElementById('reset');
    const tipEl     = document.getElementById('tip');

    document.querySelectorAll('input[name="mutType"]').forEach(r=>{
        r.addEventListener('change',()=> baseInput.parentElement.style.display = r.value==='del' ? 'none':'block');
    });
    resetBtn.onclick = ()=>{
        templateDNA = originEls.tpl.textContent.match(/[ATGC]+/g).join('');
        renderAll(templateDNA, mutEls);
        historyBox.innerHTML='';
    };
    runBtn.onclick = ()=>{
        const type = document.querySelector('input[name="mutType"]:checked').value;
        const posRaw = posInput.value.trim();
        if(!/^\d+(-\d+)?$/.test(posRaw)){tip('ä½ç‚¹æ ¼å¼é”™è¯¯');return;}
        let [start,end] = posRaw.split('-').map(n=>parseInt(n));
        if(start<1 || start>templateDNA.length){tip('ä½ç‚¹è¶…å‡ºèŒƒå›´');return;}
        if(!end) end=start;
        if(end<start||end>templateDNA.length){tip('èŒƒå›´é”™è¯¯');return;}
        let base = baseInput.value.trim().toUpperCase();
        if(type!=='del' && !/^[ATGC]$/.test(base)){tip('è¯·è¾“å…¥ A/T/G/C');return;}
        // æ‰§è¡Œçªå˜
        let before = templateDNA;
        if(type==='sub'){
            templateDNA = before.slice(0,start-1)+base+before.slice(start);
        }else if(type==='ins'){
            templateDNA = before.slice(0,start-1)+base+before.slice(start-1);
        }else{ // del
            templateDNA = before.slice(0,start-1)+before.slice(end);
        }
        renderAll(templateDNA, mutEls);
        addHistory(type,posRaw,base,before,templateDNA);
        tip('');
    };
    function tip(msg){tipEl.textContent=msg;}

    function addHistory(type,pos,base,before,after){
        const li = document.createElement('div');
        const descType = {sub:'æ›¿æ¢',ins:'æ’å…¥',del:'ç¼ºå¤±'}[type];
        li.innerHTML =
            `<div class="small mb-1"><strong>æ“ä½œæè¿°ï¼š</strong>åœ¨æ¨¡æ¿é“¾ä½ç½® ${pos} å‘ç”Ÿ${descType}${type!=='del'?` (â†’ <span class="base-${base}">${base}</span>)`:''}</div>`+
            `<div class="small">çªå˜å‰ DNA (3'-5')ï¼š ${colour(before)}</div>`+
            `<div class="small mb-2">çªå˜å DNA (3'-5')ï¼š ${colour(after)}</div>`;
        historyBox.prepend(li);
    }
</script>
</body>
</html>